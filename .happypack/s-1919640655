'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _index = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.3.3@redbox-react/lib/index.js');

var _index2 = _interopRequireDefault(_index);

var _index3 = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.0.2@react-transform-catch-errors/lib/index.js');

var _index4 = _interopRequireDefault(_index3);

var _react2 = require('react');

var React = _interopRequireWildcard(_react2);

var _index5 = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.0.4@react-transform-hmr/lib/index.js');

var _index6 = _interopRequireDefault(_index5);

var _ybacktop = require('../../components/base/ybacktop');

var _ybacktop2 = _interopRequireDefault(_ybacktop);

var _tools = require('../../configs/tools');

require('highlight.js/styles/monokai-sublime.css');

require('./api.less');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _components = {
  API: {
    displayName: 'API'
  }
};

var _UsersHuyongDesktopReactUiDemoNode_modules104ReactTransformHmrLibIndexJs2 = (0, _index6.default)({
  filename: '/Users/huyong/Desktop/react-ui-demo/demo/views/api/api.tsx',
  components: _components,
  locals: [module],
  imports: [React.default]
});

var _UsersHuyongDesktopReactUiDemoNode_modules102ReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({
  filename: '/Users/huyong/Desktop/react-ui-demo/demo/views/api/api.tsx',
  components: _components,
  locals: [],
  imports: [React.default, _index2.default]
});

function _wrapComponent(id) {
  return function (Component) {
    return _UsersHuyongDesktopReactUiDemoNode_modules104ReactTransformHmrLibIndexJs2(_UsersHuyongDesktopReactUiDemoNode_modules102ReactTransformCatchErrorsLibIndexJs2(Component, id), id);
  };
}

require('es6-promise').polyfill();
var fetch = require('isomorphic-fetch');

// start test post
fetch('/test/get', {
  method: 'GET'
}).then(function (response) {
  return response.json();
}).then(function (data) {
  console.log(data);
}).catch(function (e) {
  return console.log("error", e);
});

fetch('/test/post', {
  method: 'POST',
  mode: 'cors',
  headers: {
    'Content-Type': 'application/json'
  },
  body: (0, _stringify2.default)({
    naem: 'huy',
    age: 18
  })
}).then(function (response) {
  return response.json();
}).then(function (data) {
  console.log(data);
}).catch(function (e) {
  return console.log("error", e);
});

// end test post

var API = _wrapComponent('API')(function (_React$Component) {
  (0, _inherits3.default)(API, _React$Component);

  function API(props) {
    (0, _classCallCheck3.default)(this, API);

    var _this = (0, _possibleConstructorReturn3.default)(this, (API.__proto__ || (0, _getPrototypeOf2.default)(API)).call(this, props));

    _this.componentDidMount = function () {

      // encodeURI编码，decodeURI解码
      // var url=decodeURI('/api/UI设计.md');
      fetch('/api').then(function (response) {
        return response.json();
      }).then(function (data) {
        _this.setState({
          menu: data.src,
          content: ''
        });
      }).catch(function (e) {
        return console.log("error", e);
      });

      _this.hashChg();
      window.addEventListener('hashchange', _this.hashChg, false);
    };

    _this.hashChg = function () {
      var param = location.hash.split('?')[1],
          name = void 0;
      param && param.split('=')[1] ? name = param.split('=')[1] : (name = 'UI设计.md', location.hash = '#/api?name=' + name);
      (0, _tools.loading)(document.body);
      fetch('/api/' + name).then(function (response) {
        return response.json();
      }).then(function (data) {
        (0, _tools.loading)(document.body);
        _this.setState({
          name: name,
          content: data.html
        });
      }).catch(function (e) {
        return console.log("error", e);
      });
    };

    _this.componentWillUnmount = function () {
      window.removeEventListener('hashchange', _this.hashChg, false);
    };

    _this.state = {
      name: '',
      menu: []
    };
    return _this;
  }

  (0, _createClass3.default)(API, [{
    key: 'render',


    /*readMD=(e)=>{
      var name=e.target.innerText;
      var url='/api/'+name+'.md';
      fetch(url).then(response => response.json())
        .then(data => {
          this.setState({
            name:name+'.md',
            content:data.html
          })
        })
        .catch(e => console.log("error", e));
    };*/

    value: function render() {
      var _state = this.state,
          name = _state.name,
          menu = _state.menu,
          content = _state.content;

      return React.createElement(
        'div',
        { className: 'api' },
        React.createElement(
          'a',
          { className: 'back-to-home', href: '#/' },
          '\u4E3B\u9875'
        ),
        React.createElement(
          'div',
          { className: 'api-menu' },
          React.createElement(
            'ul',
            null,
            menu.map(function (v, k) {
              return React.createElement(
                'li',
                { key: 'menu' + k },
                React.createElement(
                  'a',
                  { className: name == v ? 'active' : '', href: '#/api?name=' + v },
                  v.slice(0, -3)
                )
              );
            })
          )
        ),
        React.createElement(
          'div',
          { className: 'api-content' },
          React.createElement(
            'h4',
            { className: 'title' },
            name.slice(0, -3)
          ),
          React.createElement('div', { dangerouslySetInnerHTML: { __html: content } })
        ),
        React.createElement(_ybacktop2.default, null)
      );
    }
  }]);
  return API;
}(React.Component));

exports.default = API;