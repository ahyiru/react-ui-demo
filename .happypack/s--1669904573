'use strict';

Object.defineProperty(exports, "__esModule", {
		value: true
});

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _index = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.3.3@redbox-react/lib/index.js');

var _index2 = _interopRequireDefault(_index);

var _index3 = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.0.2@react-transform-catch-errors/lib/index.js');

var _index4 = _interopRequireDefault(_index3);

var _react2 = require('react');

var React = _interopRequireWildcard(_react2);

var _index5 = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.0.4@react-transform-hmr/lib/index.js');

var _index6 = _interopRequireDefault(_index5);

var _yTables = require('./yTables');

var _yTables2 = _interopRequireDefault(_yTables);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _components = {
		Demo2: {
				displayName: 'Demo2'
		}
};

var _UsersHuyongDesktopReactUiDemoNode_modules104ReactTransformHmrLibIndexJs2 = (0, _index6.default)({
		filename: '/Users/huyong/Desktop/react-ui-demo/demo/views/content/test/demo2.tsx',
		components: _components,
		locals: [module],
		imports: [React.default]
});

var _UsersHuyongDesktopReactUiDemoNode_modules102ReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({
		filename: '/Users/huyong/Desktop/react-ui-demo/demo/views/content/test/demo2.tsx',
		components: _components,
		locals: [],
		imports: [React.default, _index2.default]
});

function _wrapComponent(id) {
		return function (Component) {
				return _UsersHuyongDesktopReactUiDemoNode_modules104ReactTransformHmrLibIndexJs2(_UsersHuyongDesktopReactUiDemoNode_modules102ReactTransformCatchErrorsLibIndexJs2(Component, id), id);
		};
}

require('es6-promise').polyfill();
var fetch = require('isomorphic-fetch');

/*export default class Table extends React.Component<any,any> {

  constructor(props){
    super(props);
  };

  render() {

    return (
      <Ytables yth={tableData.thead} ytb={tableData.tbody} editable={true} />
    );
  }
}*/

var obj2arr = function obj2arr(obj) {
		var arr = [];
		var keys = (0, _keys2.default)(obj);
		for (var i = 0, j = keys.length; i < j; i++) {
				if (keys[i] != '__v') {
						arr.push(obj[keys[i]]);
				}
		}
		return arr;
};

var sthead = ['id', '用户名', '密码'];

var Demo2 = _wrapComponent('Demo2')(function (_React$Component) {
		(0, _inherits3.default)(Demo2, _React$Component);

		function Demo2(props) {
				(0, _classCallCheck3.default)(this, Demo2);

				var _this = (0, _possibleConstructorReturn3.default)(this, (Demo2.__proto__ || (0, _getPrototypeOf2.default)(Demo2)).call(this, props));

				_this.addInfo = function () {
						var data = {
								username: _this.state.info.name,
								password: _this.state.info.pwd
						};
						console.log(_this.state.info);
						fetch('/add', {
								method: 'POST',
								body: (0, _stringify2.default)(data),
								headers: { 'Content-Type': 'application/json' }
						}).then(function (response) {
								return response.json();
						}).then(function (data) {
								console.log(data);
								fetch('/info').then(function (response) {
										return response.json();
								}).then(function (data) {
										console.log(data);
										_this.setState({
												data: data
										});
								}).catch(function (e) {
										return console.log("error", e);
								});
						}).catch(function (e) {
								return console.log("添加失败," + e);
						});
				};

				_this.del = function (id) {
						// var that=this;
						fetch('/delete', {
								method: 'POST',
								body: (0, _stringify2.default)({ _id: id }),
								headers: { 'Content-Type': 'application/json' }
						}).then(function (response) {
								return response.json();
						}).then(function (data) {
								console.log(data);
								fetch('/info').then(function (response) {
										return response.json();
								}).then(function (data) {
										console.log(data);
										_this.setState({
												data: data
										});
								}).catch(function (e) {
										return console.log("error", e);
								});
						}).catch(function (e) {
								return console.log("删除失败," + e);
						});
				};

				_this.getVal = function (type, e) {
						if (type == 'name') {
								_this.setState({
										info: {
												name: e.target.value,
												pwd: _this.state.info.pwd
										}
								});
						} else {
								_this.setState({
										info: {
												name: _this.state.info.name,
												pwd: e.target.value
										}
								});
						}
				};

				_this.state = {
						data: [],
						info: {
								name: '',
								pwd: ''
						}
				};
				/*fetch('/info').then(response => response.json())
    .then(data => {
    	console.log(data);
    	this.setState({
    		data:data
    	})
    })
    .catch(e => console.log("error", e));*/
				return _this;
		}

		(0, _createClass3.default)(Demo2, [{
				key: 'componentWillMount',
				value: function componentWillMount() {
						var that = this;
						fetch('/info').then(function (response) {
								return response.json();
						}).then(function (data) {
								// console.log(data);
								that.setState({
										data: data
								});
						}).catch(function (e) {
								return console.log("error", e);
						});
				}
		}, {
				key: 'componentDidMount',
				value: function componentDidMount() {
						/*fetch('/info',{
       method:'get',// 默认
       cors:'no-cors',// 默认
       headers:{
         'Content-Type':'application/x-www-form-urlencoded'
       }
      })
      .then((res)=>{
       console.log(res);
       return res.json();
      })
      .then((data)=>{
       console.log(data);
      })
      .catch((err)=>{
       console.log(err);
      });*/
						/*var that=this;
      fetch('/info').then(response => response.json())
       .then(data => {
       	// console.log(data);
       	that.setState({
       		data:data
       	})
       })
       .catch(e => console.log("error", e));*/
				}
		}, {
				key: 'componentWillUnmount',
				value: function componentWillUnmount() {}
		}, {
				key: 'render',
				value: function render() {
						// const {data}=this.state;
						var info = this.state.info;

						var that = this;
						return React.createElement(
								'div',
								null,
								React.createElement(_yTables2.default, { yth: sthead, ytb: this.state.data, editable: true }),
								React.createElement(
										'table',
										null,
										React.createElement(
												'thead',
												null,
												React.createElement(
														'tr',
														null,
														React.createElement(
																'th',
																null,
																'id'
														),
														React.createElement(
																'th',
																null,
																'\u7528\u6237\u540D'
														),
														React.createElement(
																'th',
																null,
																'\u5BC6\u7801'
														)
												)
										),
										React.createElement(
												'tbody',
												null,
												this.state.data.map(function (v, k) {
														return React.createElement(
																'tr',
																{ key: 'test' + k },
																React.createElement(
																		'td',
																		null,
																		v._id
																),
																React.createElement(
																		'td',
																		null,
																		v.username
																),
																React.createElement(
																		'td',
																		null,
																		v.password
																),
																React.createElement(
																		'td',
																		{ onClick: that.del.bind(that, v._id) },
																		'delete'
																)
														);
												})
										)
								),
								React.createElement(
										'div',
										null,
										React.createElement(
												'span',
												null,
												'\u7528\u6237\u540D\uFF1A'
										),
										React.createElement('input', { type: 'text', value: info.name, onChange: this.getVal.bind(this, 'name') }),
										React.createElement(
												'span',
												null,
												'\u5BC6 \u7801\uFF1A'
										),
										React.createElement('input', { type: 'text', value: info.pwd, onChange: this.getVal.bind(this, 'pwd') }),
										React.createElement(
												'button',
												{ onClick: this.addInfo },
												'add'
										)
								)
						);
				}
		}]);
		return Demo2;
}(React.Component));

exports.default = Demo2;