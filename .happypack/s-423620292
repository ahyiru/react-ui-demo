'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _index = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.3.3@redbox-react/lib/index.js');

var _index2 = _interopRequireDefault(_index);

var _index3 = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.0.2@react-transform-catch-errors/lib/index.js');

var _index4 = _interopRequireDefault(_index3);

var _react2 = require('react');

var React = _interopRequireWildcard(_react2);

var _index5 = require('/Users/huyong/Desktop/react-ui-demo/node_modules/.1.0.4@react-transform-hmr/lib/index.js');

var _index6 = _interopRequireDefault(_index5);

var _tools = require('../../../configs/tools');

require('./func.less');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _components = {
	Autocomplete: {
		displayName: 'Autocomplete'
	}
};

var _UsersHuyongDesktopReactUiDemoNode_modules104ReactTransformHmrLibIndexJs2 = (0, _index6.default)({
	filename: '/Users/huyong/Desktop/react-ui-demo/demo/views/content/func/autocomplete.tsx',
	components: _components,
	locals: [module],
	imports: [React.default]
});

var _UsersHuyongDesktopReactUiDemoNode_modules102ReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({
	filename: '/Users/huyong/Desktop/react-ui-demo/demo/views/content/func/autocomplete.tsx',
	components: _components,
	locals: [],
	imports: [React.default, _index2.default]
});

function _wrapComponent(id) {
	return function (Component) {
		return _UsersHuyongDesktopReactUiDemoNode_modules104ReactTransformHmrLibIndexJs2(_UsersHuyongDesktopReactUiDemoNode_modules102ReactTransformCatchErrorsLibIndexJs2(Component, id), id);
	};
}

var Autocomplete = _wrapComponent('Autocomplete')(function (_React$Component) {
	(0, _inherits3.default)(Autocomplete, _React$Component);

	function Autocomplete(props) {
		(0, _classCallCheck3.default)(this, Autocomplete);

		var _this = (0, _possibleConstructorReturn3.default)(this, (Autocomplete.__proto__ || (0, _getPrototypeOf2.default)(Autocomplete)).call(this, props));

		_this.getValue = function (e) {
			var sv = e.target.value;

			if (_this.timer) {
				clearTimeout(_this.timer);
			}
			var newArr = [];
			var that = _this;
			_this.timer = setTimeout(function () {
				if (sv) {
					(function () {
						var reg = new RegExp(sv, 'i');
						that.state.data.map(function (v, k) {
							// v+='';
							if (reg.test(v)) {
								newArr.push(v);
							}
						});
					})();
				} else {
					newArr = [];
				}
				// console.log(newArr);
				that.setState({
					result: newArr,
					selected: []
				});
			}, 200);

			_this.setState({
				sv: sv
			});
		};

		_this.selected = function (e) {
			_this.setState({
				sv: e.target.innerHTML,
				result: [],
				selected: []
			});
		};

		_this.mouseEnter = function (e) {
			var newArr = _this.state.result;
			var selected = [];
			newArr.map(function (v, k) {
				selected[k] = false;
				if (v == e.target.innerHTML) {
					selected[k] = true;
				}
			});
			_this.setState({
				selected: selected
			});
		};

		_this.keyEvent = function (e) {
			var k = e.which || e.keyCode;
			var newArr = _this.state.result;
			var selected = _this.state.selected;
			var f = false;
			switch (k) {
				case 38:
					newArr.map(function (v, k) {
						if (!f) {
							if (selected[k]) {
								selected[k] = false;
								if (k == 0) k = newArr.length;
								selected[k - 1] = true;
								f = true;
							}
						}
					});
					if (!f) selected[newArr.length - 1] = true;
					_this.setState({
						selected: selected
					});
					break;
				case 40:
					newArr.map(function (v, k) {
						if (!f) {
							if (selected[k]) {
								selected[k] = false;
								if (k == newArr.length - 1) k = -1;
								selected[k + 1] = true;
								f = true;
							}
						}
					});
					if (!f) selected[0] = true;
					_this.setState({
						selected: selected
					});
					break;
				case 13:
					var sv;
					newArr.map(function (v, k) {
						if (selected[k]) {
							sv = v;
						}
					});
					_this.setState({
						sv: sv,
						result: [],
						selected: []
					});
					break;
			}
		};

		_this.timer = 0;
		_this.state = {
			data: (0, _tools.yunique)(_this.props.data),
			sv: '',
			result: [],
			selected: []
		};
		return _this;
	}

	(0, _createClass3.default)(Autocomplete, [{
		key: 'componentDidMount',
		value: function componentDidMount() {
			var t = this.state.data.sort(_tools.ysort);
			console.log(t);
		}
	}, {
		key: 'componentWillUnmount',
		value: function componentWillUnmount() {}
	}, {
		key: 'render',
		value: function render() {
			var _this2 = this;

			var _state = this.state,
			    sv = _state.sv,
			    result = _state.result,
			    selected = _state.selected;

			return React.createElement(
				'div',
				{ className: 'y-autocomplete' },
				React.createElement(
					'h2',
					null,
					this.props.title
				),
				React.createElement(
					'div',
					{ className: 'input-area' },
					React.createElement('input', { className: 'y-input', type: 'text', value: sv, onChange: this.getValue, onKeyUp: this.keyEvent }),
					!!result.length && React.createElement(
						'ul',
						{ onClick: this.selected },
						result.map(function (v, k) {
							return React.createElement(
								'li',
								{ className: selected[k] ? 'selected' : '', key: 'r-' + k, onMouseEnter: _this2.mouseEnter },
								v
							);
						})
					)
				)
			);
		}
	}]);
	return Autocomplete;
}(React.Component));

exports.default = Autocomplete;